<nav class="blue darken-2">
    <div class="nav-wrapper container">
        <a href="/" class="brand-logo">
            <i class="material-icons">lock</i>
            Express Auth
        </a>
        <a href="#" data-target="mobile-nav" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        <ul class="right hide-on-med-and-down" id="nav-menu">
            <!-- Se llenará dinámicamente con JavaScript -->
        </ul>
    </div>
</nav>

<!-- Mobile Navigation -->
<ul class="sidenav" id="mobile-nav">
    <!-- Se llenará dinámicamente con JavaScript -->
</ul>

<script>
    // Inicializar menú basado en autenticación
    document.addEventListener('DOMContentLoaded', function() {
        const token = sessionStorage.getItem('token');
        const navMenu = document.getElementById('nav-menu');
        const mobileNav = document.getElementById('mobile-nav');
        
        if (token) {
            const payload = parseJwt(token);
            const roles = payload.roles || [];
            const isAdmin = roles.includes('admin');
            
            let menuItems = `
                <li><a href="/profile"><i class="material-icons left">person</i>Mi Perfil</a></li>
                <li><a href="/dashboard-user"><i class="material-icons left">dashboard</i>Dashboard</a></li>
            `;
            
            if (isAdmin) {
                menuItems += `<li><a href="/dashboard-admin"><i class="material-icons left">admin_panel_settings</i>Admin</a></li>`;
            }
            
            menuItems += `<li><a href="#" onclick="logout()"><i class="material-icons left">exit_to_app</i>Cerrar Sesión</a></li>`;
            
            navMenu.innerHTML = menuItems;
            mobileNav.innerHTML = menuItems;
        } else {
            const menuItems = `
                <li><a href="/signin"><i class="material-icons left">login</i>Iniciar Sesión</a></li>
                <li><a href="/signup"><i class="material-icons left">person_add</i>Registrarse</a></li>
            `;
            navMenu.innerHTML = menuItems;
            mobileNav.innerHTML = menuItems;
        }
        
        // Inicializar sidenav
        M.Sidenav.init(document.querySelectorAll('.sidenav'));
    });

    function parseJwt(token) {
        try {
            return JSON.parse(atob(token.split('.')[1]));
        } catch (e) {
            return {};
        }
    }

    function logout() {
        sessionStorage.removeItem('token');
        window.location.href = '/signin';
    }
</script>